<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verkaufsplattform - Bundesamt für Bauten und Logistik</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <a href="#main" class="skip-link">Zum Hauptinhalt springen</a>
  <header class="header">
    <div class="header-left">
      <div class="logo"><img src="assets/images/ch.png" alt="Schweizer Wappen"></div>
      <div class="header-title">
        <span class="header-title-main">Verkaufsplattform</span>
        <span class="header-title-sub">Bundesamt für Bauten und Logistik</span>
        <span class="header-title-sub">Immobilienmanagement</span>
      </div>
    </div>
    <div class="header-right">
      <button class="btn btn-primary" onclick="openSalesForm()">Auftrag erstellen</button>
      <button class="btn btn-outline" onclick="openLoginDialog()">Login</button>
    </div>
  </header>

  <div class="search-section">
    <div class="search-section-inner">
      <div class="search-row">
        <div class="search-input-wrapper">
          <span class="material-icons-outlined">search</span>
          <input type="text" class="search-input" id="searchInput" placeholder="Suche nach Bezeichnung, Adresse, oder Wirtschaftseinheit">
        </div>
        <div class="view-toggle">
          <button class="view-btn" data-view="map" title="Karte"><span class="material-icons-outlined">map</span></button>
          <button class="view-btn" data-view="list" title="Liste"><span class="material-icons-outlined">reorder</span><span class="view-btn-label">Liste</span></button>
          <button class="view-btn active" data-view="gallery" title="Galerie"><span class="material-icons-outlined">grid_view</span></button>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-pills" id="filterPills"></div>
        <div class="filter-right">
          <div class="stats-count"><span id="objectCount">0</span> Objekte</div>
          <button class="filter-btn" id="filterBtn">
            <span>Filter</span>
            <span class="filter-count" id="filterCount" style="display: none;">0</span>
            <span class="material-icons-outlined">tune</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <main class="main" id="main">
    <div class="view-container active" id="galleryView">
      <div class="grid" id="objectGrid"></div>
    </div>

    <div class="view-container" id="listView">
      <div class="stats-boxes" id="statsBoxes">
        <div class="stats-box"><div class="stats-box-value" id="statsTotalObjects">0</div><div class="stats-box-label">Anzahl Objekte</div></div>
        <div class="stats-box"><div class="stats-box-value" id="statsHighPriority">0</div><div class="stats-box-label">Hohe Priorität</div></div>
        <div class="stats-box"><div class="stats-box-value" id="statsNormalPriority">0</div><div class="stats-box-label">Normale Priorität</div></div>
        <div class="stats-box"><div class="stats-box-value" id="statsLowPriority">0</div><div class="stats-box-label">Geringe Priorität</div></div>
        <div class="stats-box stats-box-download" onclick="exportToExcel()"><span class="material-icons-outlined">download</span><div class="stats-box-label">Excel Download</div></div>
      </div>
      <div class="list-table-container">
        <table class="list-table">
          <thead><tr><th></th><th>ID</th><th>Objekt</th><th>Verkaufsjahr</th><th>Priorisierung</th><th>Meilenstein</th><th>Objekt Fläche</th><th>Marktwert</th></tr></thead>
          <tbody id="listTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="map-container" id="mapView">
      <div class="map-sidebar" id="mapSidebar"></div>
      <div class="map-area">
        <div id="map"></div>
      </div>
    </div>
  </main>

  <!-- Detail View (Single Page) -->
  <div class="detail-view" id="detailView">
    <div class="detail-header">
      <div class="detail-header-inner">
        <span class="detail-breadcrumb" id="detailBreadcrumb"></span>
        <div class="detail-header-actions">
          <button class="btn btn-primary" onclick="exportToPdf()">Als PDF exportieren</button>
          <button class="btn btn-secondary detail-back-btn" onclick="closeDetailPage()">
            <span class="material-icons-outlined">arrow_back</span>
            Zurück zur Übersicht
          </button>
        </div>
      </div>
    </div>
    <div class="detail-content" id="detailContent">
      <!-- Content will be rendered by JavaScript -->
    </div>
  </div>

  <!-- Sales Form View -->
  <div class="sales-form-view" id="salesFormView">
    <div class="sales-form-header">
      <div class="sales-form-header-inner">
        <h1 class="sales-form-title">Auftrag erstellen</h1>
        <button class="btn btn-secondary" onclick="closeSalesForm()">Abbrechen</button>
      </div>
    </div>
    <div class="sales-form-container">
      <aside class="sales-form-sidebar">
        <div class="sales-form-sidebar-inner">
          <div class="sales-form-sidebar-title">In 4 Schritten</div>
          <div class="sales-form-progress">
            <div class="sales-form-progress-bar" id="salesFormProgressBar" style="width: 25%"></div>
          </div>
          <div class="sales-form-steps" id="salesFormSteps">
            <div class="sales-form-step active" data-step="1" onclick="goToSalesFormStep(1)">
              <span class="sales-form-step-icon">1</span>
              <span>Objekt erfassen</span>
            </div>
            <div class="sales-form-step" data-step="2" onclick="goToSalesFormStep(2)">
              <span class="sales-form-step-icon">2</span>
              <span>Angaben zum Objekt</span>
            </div>
            <div class="sales-form-step" data-step="3" onclick="goToSalesFormStep(3)">
              <span class="sales-form-step-icon">3</span>
              <span>Angaben zum Mieter</span>
            </div>
            <div class="sales-form-step" data-step="4" onclick="goToSalesFormStep(4)">
              <span class="sales-form-step-icon">4</span>
              <span>Zusammenfassung</span>
            </div>
          </div>
          <div class="sales-form-final-step">Auftrag erstellt</div>
        </div>
      </aside>
      <div class="sales-form-content" id="salesFormContent">
        <!-- Step content will be rendered by JavaScript -->
      </div>
    </div>
  </div>

  <!-- Filter Modal -->
  <div class="filter-modal-overlay" id="filterModalOverlay" role="dialog" aria-modal="true" aria-labelledby="filterModalTitle">
    <div class="filter-modal">
      <div class="filter-modal-header">
        <h2 id="filterModalTitle">Suchfilter</h2>
        <div class="filter-modal-actions">
          <button class="filter-reset-btn" id="filterResetBtn" title="Filter zurücksetzen">
            <span class="material-icons-outlined">refresh</span>
          </button>
          <button class="filter-close-btn" id="filterCloseBtn">
            <span class="material-icons-outlined">close</span>
          </button>
        </div>
      </div>
      <div class="filter-modal-body">
        <div class="filter-columns">
          <div class="filter-column">
            <h3 class="filter-column-title">Nutzung</h3>
            <div class="filter-options" id="filterNutzung"></div>
          </div>
          <div class="filter-column">
            <h3 class="filter-column-title">Verkaufsjahr</h3>
            <div class="filter-options" id="filterYear"></div>
          </div>
          <div class="filter-column">
            <h3 class="filter-column-title">Priorisierung</h3>
            <div class="filter-options" id="filterPriority"></div>
          </div>
          <div class="filter-column">
            <h3 class="filter-column-title">Meilenstein</h3>
            <div class="filter-options" id="filterMilestone"></div>
          </div>
          <div class="filter-column">
            <h3 class="filter-column-title">Portfolio</h3>
            <div class="filter-options" id="filterPortfolio"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Carousel -->
  <div class="carousel-overlay" id="carouselOverlay" role="dialog" aria-modal="true" aria-label="Bildergalerie">
    <div class="carousel-header">
      <span class="carousel-counter" id="carouselCounter" aria-live="polite">1 / 5</span>
      <button class="carousel-close-btn" onclick="closeCarousel()" title="Schliessen (Esc)">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    <div class="carousel-main" onclick="if(event.target === this) closeCarousel()">
      <button class="carousel-nav-btn prev" onclick="navigateCarousel(-1)" title="Vorheriges Bild">
        <span class="material-icons-outlined">chevron_left</span>
      </button>
      <div class="carousel-image-container">
        <img class="carousel-image" id="carouselImage" src="" alt="Bild">
      </div>
      <button class="carousel-nav-btn next" onclick="navigateCarousel(1)" title="Nächstes Bild">
        <span class="material-icons-outlined">chevron_right</span>
      </button>
    </div>
    <div class="carousel-thumbnails" id="carouselThumbnails"></div>
  </div>

  <!-- Upload Document Dialog -->
  <div class="dialog-overlay" id="uploadDialogOverlay" role="dialog" aria-modal="true" aria-labelledby="uploadDialogTitle" onclick="if(event.target === this) closeUploadDialog()">
    <div class="upload-dialog">
      <div class="dialog-header">
        <h3 class="dialog-title" id="uploadDialogTitle">Dokument hochladen</h3>
        <button class="dialog-close-btn" onclick="closeUploadDialog()" aria-label="Schliessen">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <div class="upload-step">
        <div class="upload-step-label">1. Datei auswählen</div>
        <div class="upload-dropzone" id="uploadDropzone" onclick="document.getElementById('uploadFileInput').click()">
          <span id="uploadDropzoneText" class="upload-dropzone-text">Datei auswählen</span>
        </div>
        <input type="file" id="uploadFileInput" style="display: none;" onchange="handleFileSelect(this.files[0])">
      </div>

      <div class="upload-step">
        <div class="upload-step-label">2. Art der Datei auswählen</div>
        <select class="upload-select" id="uploadTypeSelect" onchange="validateUploadForm()">
          <option value="">Choose an option...</option>
          <option value="3D-Modelldaten">3D-Modelldaten</option>
          <option value="Ansichtsplan">Ansichtsplan</option>
          <option value="Auszug ÖREB-Kataster">Auszug ÖREB-Kataster</option>
          <option value="Akte zu Unterhalt">Akte zu Unterhalt</option>
          <option value="Grundrissplan">Grundrissplan</option>
          <option value="Indikative Marktwertbewertung">Indikative Marktwertbewertung</option>
          <option value="Kauf- Dienstbarkeitsvertrag">Kauf- Dienstbarkeitsvertrag</option>
          <option value="Mieterdossier">Mieterdossier</option>
          <option value="Mietvertrag">Mietvertrag</option>
          <option value="Schliessplan / Sicherungsschein">Schliessplan / Sicherungsschein</option>
          <option value="Serviceverträge">Serviceverträge</option>
          <option value="Sonstiges">Sonstiges</option>
        </select>
      </div>

      <div class="upload-step">
        <div class="upload-step-label">3. Dateiname</div>
        <input type="text" class="form-input" id="uploadNameInput" placeholder="Dateiname eingeben" oninput="validateUploadForm()">
      </div>

      <div class="dialog-actions">
        <button class="btn btn-secondary" onclick="closeUploadDialog()">Abbrechen</button>
        <button class="btn btn-primary" id="uploadSubmitBtn" onclick="submitDocumentUpload()" disabled>Hochladen</button>
      </div>
    </div>
  </div>

  <!-- Login Dialog -->
  <div class="dialog-overlay" id="loginDialogOverlay" role="dialog" aria-modal="true" aria-labelledby="loginDialogTitle" onclick="if(event.target === this) closeLoginDialog()">
    <div class="login-dialog">
      <div class="dialog-header">
        <h3 class="dialog-title" id="loginDialogTitle">Anmelden</h3>
        <button class="dialog-close-btn" onclick="closeLoginDialog()" aria-label="Schliessen">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <div class="login-form">
        <div class="login-field">
          <label class="login-label" for="loginEmail">E-Mail</label>
          <input type="email" class="form-input" id="loginEmail" placeholder="name@beispiel.ch">
        </div>

        <div class="login-field">
          <label class="login-label" for="loginPassword">Passwort</label>
          <input type="password" class="form-input" id="loginPassword" placeholder="Passwort eingeben">
        </div>
      </div>

      <div class="login-links">
        <a class="login-link" onclick="alert('Funktion noch nicht verfügbar')">Kennwort vergessen?</a>
        <a class="login-link" onclick="alert('Funktion noch nicht verfügbar')">Neu registrieren</a>
      </div>

      <div class="dialog-actions">
        <button class="btn btn-secondary" onclick="closeLoginDialog()">Abbrechen</button>
        <button class="btn btn-primary" onclick="submitLogin()">Anmelden</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-left">
      <a href="https://github.com/bbl-dres/transaction-immo" class="footer-link" target="_blank" rel="noopener noreferrer">Quellcode</a>
      <a href="" class="footer-link" target="_blank" rel="noopener noreferrer">API</a>
      <a href="https://www.admin.ch/gov/de/start/rechtliches.html" class="footer-link" target="_blank" rel="noopener noreferrer">Rechtliches</a>
    </div>
    <span class="footer-version">v1.0.0</span>
  </footer>

  <script src="js/main.js"></script>
</body>
</html>
